(()=>{var t={162:function(t,e,n){var a;void 0===(a=function(){"use strict";function e(t,e,n){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(){d(a.response,e,n)},a.onerror=function(){console.error("could not download file")},a.send()}function a(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,l=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(t,n,l){var d=i.URL||i.webkitURL,s=document.createElement("a");n=n||t.name||"download",s.download=n,s.rel="noopener","string"==typeof t?(s.href=t,s.origin===location.origin?o(s):a(s.href)?e(t,n,l):o(s,s.target="_blank")):(s.href=d.createObjectURL(t),setTimeout((function(){d.revokeObjectURL(s.href)}),4e4),setTimeout((function(){o(s)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,n,i){if(n=n||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,i),n);else if(a(t))e(t,n,i);else{var l=document.createElement("a");l.href=t,l.target="_blank",setTimeout((function(){o(l)}))}}:function(t,n,a,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,a);var d="application/octet-stream"===t.type,s=/constructor/i.test(i.HTMLElement)||i.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent);if((r||d&&s||l)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=r?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=t:location=t,o=null},c.readAsDataURL(t)}else{var p=i.URL||i.webkitURL,u=p.createObjectURL(t);o?o.location=u:location.href=u,o=null,setTimeout((function(){p.revokeObjectURL(u)}),4e4)}});i.saveAs=d.saveAs=d,t.exports=d}.apply(e,[]))||(t.exports=a)}},e={};function n(a){var o=e[a];if(void 0!==o)return o.exports;var i=e[a]={exports:{}};return t[a].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";Shiny;var t=n(162);function e(t,e,n,a){let o,i=!1;return o=a?t.find("tbody tr").not(a):t.find("tbody tr"),o.filter((function(){$(this).data(e)===n&&(i=!0)})),i}function a(t,n,a){let o=$("#my-dataset-table-"+t);n=n.trim();let i=1;for(;e(o,"name",n,a);)n.match(/\(\d+\)$/)?n=n.replace(/\(\d+\)$/,"("+i+")"):n+=" ("+i+")",i++;return n}Shiny.addCustomMessageHandler("build-myDataset",(t=>{let e=t.id,n=t.maxRows;$("#"+e).length>0&&function(t,e=10){let n=$("<table class='table table-striped' id='my-dataset-table-"+t+"'></table>");n.data("maxRows",e);n.append("<thead><tr></tr></thead>");let a=$("<th class='align-middle' ></th>");a.append(function(t){let e=$("<input class='form-check-input' type='checkbox' id='my-dataset-table-"+t+"-select-all'>");return e.change((function(){$("#my-dataset-table-"+t).find("tbody").find("tr").each((function(){$(this).find("input[type='checkbox']").prop("checked",e.prop("checked"))}))})),e}(t)),n.find("thead tr").append(a),["Name","Description","Size","Actions"].forEach((function(t){n.find("thead tr").append("<th scope='col'>"+t+"</th>")})),n.append("<tbody></tbody>"),$("#"+t).append(n)}(e,n)})),Shiny.addCustomMessageHandler("add-row-myDataset",(t=>{let e=t.id,n=t.row_id,o=t.name,i=t.size;o=a(e,o),function(t,e,n,o){let i=new Date;console.log(`Adding row to custom dataset table: ${t}, ${e}, ${n}, ${o}`);let l=$("#my-dataset-table-"+t).find("tbody"),d=$("<tr id='my-dataset-row-"+e+"' class='allign-middle'></tr>");d.data("rowId",e),d.data("inputID",t),d.data("name",n),d.data("description",""),d.data("size",o),d.data("date",i);let s=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+" GMT"+i.getTimezoneOffset()/60*-1;Shiny.setInputValue(d.data("inputID"),{action:"set_time",id:e,time:s},{priority:"event"}),d.append("<td class='align-middle'><input type='checkbox' class='form-check-input my-dataset-table-"+t+"-select-row'></td>"),d.append(function(t){let e=$("<td class='align-middle'></td>"),n=$("<b>"+t+"</b>");return function(t){0===t.text().trim().length&&(t.text("untitled..."),t.css("font-style","italic")),t.click((function(){t.attr("contenteditable","true"),t.focus(),t.css("font-style","normal")})),t.keypress((function(e){13==e.which&&(t.attr("contenteditable",!1),t.blur())})),t.blur((function(){t.attr("contenteditable","false");let e=t.closest("tr"),n=t.text();if(n=n.trim(),0===n.length)n=a(e.data("inputID"),"untitled",e),t.text(n),t.css("font-style","italic"),e.data("name","");else{n=a(e.data("inputID"),n,e),e.data("name",n),t.text(n),t.css("font-style","normal");let o=e.data("inputID"),i=e.data("rowId");Shiny.setInputValue(o,{action:"name_change",id:i,name:n},{priority:"event"})}}))}(n),e.append(n),e}(n)),d.append(function(t=""){let e=$("<td class='align-middle'></td>");""===t&&(e.css("font-style","italic"),t="No description...");let n=$("<p>"+t+"</p>");return function(t){t.click((function(){t.css("font-style","normal"),t.attr("contenteditable","true"),t.focus()})),t.keypress((function(e){13===e.which&&(t.attr("contenteditable",!1),t.blur())})),t.blur((function(){t.attr("contenteditable","false");let e=t.closest("tr"),n=t.text();n=n.trim(),0===n.length&&(t.css("font-style","italic"),t.text("No description..."),e.data("description",""));let a=e.data("inputID"),o=e.data("rowId");Shiny.setInputValue(a,{action:"description_change",id:o,description:n},{priority:"event"}),e.data("description",n)}))}(n),e.append(n),e}("")),d.append(function(t){let e=$("<td class='align-middle'></td>"),n=t+" donor";t>1&&(n+="s");let a=$("<p>"+n+"</p>");return e.append(a),e}(o)),d.append(function(t,e){let n=$("<td class='align-middle'></td>"),a=$("<div class='btn-group' role='group'></div>");n.append(a),a.append(function(t,e){let n="download-dropdown-"+t,a=$("<div class='dropdown'></div>"),o=$("<button class='btn btn-outline-primary btn-sm dropdown-toggle' type='button' data-bs-toggle='dropdown' aria-expanded='false'><i class='fas fa-download'></i></button>");o.attr("id",n);let i=$("<ul class='dropdown-menu' aria-labelledby='dropdownMenuButton'></ul>");i.attr("aria-labelledby",n);let l=$("<li><a class='dropdown-item' href='#'><i class='fas fa-file-arrow-down'></i> Download data</a></li>");l.on("click",(function(){!function(t){console.log("download data pressed");let e=$("#my-dataset-row-"+t),n=e.data("rowId"),a=e.data("inputID");console.log(`inputID: ${a}`),console.log(`id: ${n}`),Shiny.setInputValue(a,{action:"download_data",id:n},{priority:"event"})}(e)}));let d=$("<li><a class='dropdown-item' href='#'><i class='fas fa-filter'></i> Download filters</a></li>");return d.on("click",(function(){!function(t){console.log("download filter pressed");let e=$("#my-dataset-row-"+t),n=e.data("rowId"),a=e.data("inputID");console.log(`inputID: ${a}`),console.log(`id: ${n}`),Shiny.setInputValue(a,{action:"download_filter",id:n},{priority:"event"})}(e)})),i.append(l),i.append(d),a.append(o),a.append(i),a}(t,e));let o=$("<button class='btn btn-danger btn-sm' type='button' data-toggle='tooltip' data-placement='top' title='Delete'></button>");return o.append("<i class='fas fa-trash-alt'></i>"),o.click((function(){let n=$("#my-dataset-row-"+e),a=n.data("name")?'"'+n.data("name")+'"':"this unnamed dataset";if(confirm(`Are you sure you want to delete ${a}?`)){let n=$("#my-dataset-row-"+e).data("inputID");Shiny.setInputValue(n,{action:"delete",id:e},{priority:"event"}),function(t,e){$("#my-dataset-table-"+t).find("tbody").find("#my-dataset-row-"+e).remove()}(t,e)}})),a.append(o),n}(t,e)),l.append(d)}(e,n,o,i)})),Shiny.addCustomMessageHandler("download-handler-myDataset",(e=>{if(e.hasOwnProperty("filename")&&e.hasOwnProperty("extension")&&e.hasOwnProperty("content"))if("csv"===e.extension){console.log(e.content);let n=new Blob([e.content],{type:"text/csv;charset=utf-8"});(0,t.saveAs)(n,e.filename+"."+e.extension)}else if("json"===e.extension){let n=new Blob([JSON.stringify(e.content,null,2)],{type:"text/plain;charset=utf-8"});(0,t.saveAs)(n,e.filename+"."+e.extension)}else console.log("Extension not supported.");else console.log("Error: Data does not have the correct properties.")}))})()})();